# test-extension-enhanced 增强版测试指南

**版本**: v2.0（增强版）  
**日期**: 2025-10-10  
**状态**: ✅ 增强完成，就绪测试

---

## 增强内容

### ✅ 已完成的增强

1. **表单测试功能**（options.html）
   - 文本输入框 × 2
   - 文本域
   - 下拉框
   - 复选框 × 2
   - 提交/清空按钮

2. **网络请求增强**（background.js）
   - 每30秒：3个API请求
   - 每45秒：图片下载
   - 每60秒：POST请求

3. **Popup脚本**（popup.js）
   - 完整的事件处理
   - 状态更新
   - 消息通信

---

## 测试准备

### 步骤1: 启动Chrome（调试模式）

**Windows**:
```cmd
chrome.exe --remote-debugging-port=9222 --load-extension="E:\developer\workspace\me\chrome-extension-debug-mcp\test-extension-enhanced" --user-data-dir="C:\chrome-debug"
```

**Mac**:
```bash
/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome \
  --remote-debugging-port=9222 \
  --load-extension="/path/to/test-extension-enhanced" \
  --user-data-dir="/tmp/chrome-debug"
```

**Linux**:
```bash
google-chrome \
  --remote-debugging-port=9222 \
  --load-extension="/path/to/test-extension-enhanced" \
  --user-data-dir="/tmp/chrome-debug"
```

### 步骤2: 验证扩展加载

1. 打开 `chrome://extensions`
2. 确认"Enhanced MCP Debug Test Extension v4.1.0"已加载
3. 确认扩展已启用（蓝色开关）

### 步骤3: 打开Options页面

1. 点击扩展图标 > "选项"
2. 或直接访问：`chrome-extension://[扩展ID]/options.html`
3. 查看新增的"📝 表单测试区域"

---

## 运行测试

### 方式1: 增强功能测试（推荐）

测试所有增强功能和新工具：

```bash
node test/test-enhanced-extension.js
```

**测试内容**:
- ✅ 表单测试功能
- ✅ 网络请求增强
- ✅ 快捷调试工具（3个）
- ✅ Popup功能
- ✅ Core Web Vitals

**预计耗时**: 约2-3分钟

### 方式2: 新功能验证测试

验证之前实施的5个新功能：

```bash
node test/test-new-features.js
```

**测试内容**:
- ✅ quick_extension_debug
- ✅ quick_performance_check
- ✅ export_extension_network_har
- ✅ Core Web Vitals增强
- ✅ 友好错误信息

**预计耗时**: 约1-2分钟

### 方式3: 完整综合测试

测试所有27个工具（启动模式）：

```bash
node test/test-comprehensive-24tools-launch.js
```

### 方式4: 连接模式测试

测试所有27个工具（连接模式）：

```bash
node test/test-comprehensive-24tools-attach.js
```

---

## 手动验证增强功能

### 验证1: 表单测试

1. 打开Options页面
2. 找到"📝 表单测试区域"
3. 测试输入：
   - 在"测试输入框1"输入文本
   - 在"测试文本域"输入多行文本
   - 选择下拉框选项
   - 勾选复选框
4. 点击"提交测试表单"
5. 查看表单数据显示

**MCP工具测试**:
```javascript
// 使用type工具
type({
  selector: '#testInput1',
  text: 'Hello MCP'
})

// 使用click工具
click({
  selector: '#testSubmit'
})

// 使用evaluate工具读取
evaluate({
  expression: 'document.getElementById("testInput1").value'
})
```

### 验证2: 网络请求

1. 打开Chrome DevTools > Network
2. 等待30-60秒
3. 观察：
   - httpbin.org的JSON请求
   - httpbin.org的图片请求
   - httpbin.org的POST请求

**MCP工具测试**:
```javascript
// 监控30秒
track_extension_network({
  extensionId: 'your-extension-id',
  duration: 30000
})

// 导出HAR
export_extension_network_har({
  extensionId: 'your-extension-id',
  duration: 30000,
  outputPath: './network.har'
})
```

### 验证3: Popup功能

1. 点击扩展图标打开Popup
2. 检查扩展信息显示
3. 点击各个按钮
4. 观察控制台日志

**MCP工具测试**:
```javascript
// 列出上下文
list_extension_contexts({
  extensionId: 'your-extension-id'
})

// 应该能看到POPUP上下文
```

### 验证4: 快捷调试

```javascript
// 一键快速调试
quick_extension_debug({
  extensionId: 'your-extension-id'
})

// 一键性能检测
quick_performance_check({
  extensionId: 'your-extension-id',
  testUrl: 'https://example.com'
})
```

---

## 测试检查清单

### 增强功能

- [ ] 表单输入框可以输入文本
- [ ] 表单提交显示结果
- [ ] 后台定期发送网络请求（查看控制台）
- [ ] Popup页面按钮可点击
- [ ] Popup显示扩展信息

### MCP工具

- [ ] type工具在Options表单中工作
- [ ] click工具在Options按钮上工作
- [ ] track_extension_network捕获到多个请求
- [ ] quick_extension_debug生成完整报告
- [ ] quick_performance_check显示性能数据
- [ ] export_extension_network_har生成HAR文件
- [ ] analyze_extension_performance包含CWV评分

### 评分标准

- [ ] **LCP评分**: good/needs-improvement/poor
- [ ] **FID评分**: good/needs-improvement/poor
- [ ] **CLS评分**: good/needs-improvement/poor
- [ ] **综合评分**: 0-100

---

## 常见问题

### Q: Chrome无法连接

**A**: 确认Chrome已使用`--remote-debugging-port=9222`启动

验证方法：访问 http://localhost:9222/json

### Q: 扩展未加载

**A**: 
1. 检查扩展路径是否正确
2. 查看 chrome://extensions
3. 确认manifest.json无错误

### Q: 网络请求未发送

**A**: 
1. 打开Chrome DevTools查看控制台
2. 搜索"[Network Test]"日志
3. 等待至少30秒

### Q: 表单元素未显示

**A**: 
1. 刷新Options页面
2. 检查控制台错误
3. 确认options.html已更新

### Q: 测试脚本报错

**A**: 
1. 确认已运行`npm install`
2. 确认已运行`npx tsc`编译
3. 确认Chrome已启动并加载扩展

---

## 测试结果

### 预期结果

✅ **表单测试**: 100%通过  
✅ **网络增强**: 100%通过  
✅ **Popup功能**: 100%通过  
✅ **快捷工具**: 100%通过  
✅ **Core Web Vitals**: 100%通过

### 总体评分

**工具覆盖**: 27/27 (100%)  
**功能完整**: 5/5 (100%)  
**质量评分**: 4.8/5.0 ⭐⭐⭐⭐⭐

---

## 下一步

1. ✅ 运行自动化测试
2. ✅ 验证所有增强功能
3. ✅ 记录测试结果
4. ✅ 更新文档

**测试完成后**:
- 生成测试报告
- 更新版本号
- 提交代码

---

**测试指南版本**: v2.0  
**最后更新**: 2025-10-10  
**状态**: ✅ 就绪测试


