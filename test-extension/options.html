<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>MCP Debug Test Extension - é€‰é¡¹</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      margin-bottom: 24px;
    }
    
    .section {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .section h3 {
      margin-top: 0;
      color: #333;
      border-bottom: 2px solid #eee;
      padding-bottom: 8px;
    }
    
    .option-group {
      margin-bottom: 16px;
    }
    
    .option-group label {
      display: block;
      font-weight: 500;
      margin-bottom: 4px;
    }
    
    .option-group input,
    .option-group select {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .checkbox-group {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .checkbox-group input[type="checkbox"] {
      width: auto;
      margin-right: 8px;
    }
    
    .button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      margin-right: 8px;
      margin-bottom: 8px;
    }
    
    .button:hover {
      background: #45a049;
    }
    
    .button.secondary {
      background: #6c757d;
    }
    
    .button.secondary:hover {
      background: #5a6268;
    }
    
    .status {
      padding: 12px;
      border-radius: 6px;
      margin: 12px 0;
      display: none;
    }
    
    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .debug-info {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
      white-space: pre-wrap;
      max-height: 200px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸ” MCP Debug Test Extension</h1>
    <p>æ‰©å±•è°ƒè¯•åŠŸèƒ½é…ç½®ä¸æµ‹è¯•</p>
  </div>
  
  <div class="section">
    <h3>ğŸ“Š æ‰©å±•ä¿¡æ¯</h3>
    <div class="option-group">
      <label>æ‰©å±•ID:</label>
      <input type="text" id="extensionId" readonly>
    </div>
    <div class="option-group">
      <label>ç‰ˆæœ¬:</label>
      <input type="text" id="extensionVersion" readonly>
    </div>
    <div class="option-group">
      <label>Manifestç‰ˆæœ¬:</label>
      <input type="text" id="manifestVersion" readonly>
    </div>
  </div>
  
  <div class="section">
    <h3>ğŸ”§ è°ƒè¯•é…ç½®</h3>
    <div class="checkbox-group">
      <input type="checkbox" id="enableVerboseLogging">
      <label for="enableVerboseLogging">å¯ç”¨è¯¦ç»†æ—¥å¿—è®°å½•</label>
    </div>
    <div class="checkbox-group">
      <input type="checkbox" id="enablePerformanceMonitoring">
      <label for="enablePerformanceMonitoring">å¯ç”¨æ€§èƒ½ç›‘æ§</label>
    </div>
    <div class="checkbox-group">
      <input type="checkbox" id="enableConflictDetection">
      <label for="enableConflictDetection">å¯ç”¨å†²çªæ£€æµ‹</label>
    </div>
    <div class="option-group">
      <label for="logLevel">æ—¥å¿—çº§åˆ«:</label>
      <select id="logLevel">
        <option value="debug">Debug</option>
        <option value="info" selected>Info</option>
        <option value="warn">Warning</option>
        <option value="error">Error</option>
      </select>
    </div>
  </div>
  
  <div class="section">
    <h3>ğŸ§ª æµ‹è¯•åŠŸèƒ½</h3>
    <button class="button" id="testAllFeatures">ğŸš€ å®Œæ•´åŠŸèƒ½æµ‹è¯•</button>
    <button class="button" id="generateLogs">ğŸ“ ç”Ÿæˆæµ‹è¯•æ—¥å¿—</button>
    <button class="button" id="testStorage">ğŸ—„ï¸ æµ‹è¯•å­˜å‚¨</button>
    <button class="button" id="testConflicts">âš ï¸ æµ‹è¯•å†²çªæ£€æµ‹</button>
    <button class="button secondary" id="clearStorage">ğŸ§¹ æ¸…é™¤å­˜å‚¨</button>
    <button class="button secondary" id="resetSettings">ğŸ”„ é‡ç½®è®¾ç½®</button>
    
    <div class="status" id="statusMessage"></div>
  </div>
  
  <div class="section">
    <h3>ğŸ” å­˜å‚¨çŠ¶æ€</h3>
    <button class="button" id="viewStorage">ğŸ“‹ æŸ¥çœ‹å­˜å‚¨å†…å®¹</button>
    <div class="debug-info" id="storageContent" style="display: none;"></div>
  </div>
  
  <div class="section">
    <h3>ğŸ“ˆ å®æ—¶ä¿¡æ¯</h3>
    <div class="debug-info" id="realTimeInfo"></div>
  </div>

  <script>
    // Options page script for MCP Debug Test Extension
    console.log('[Options] ğŸ› ï¸ é€‰é¡¹é¡µé¢åŠ è½½');
    
    const elements = {
      extensionId: document.getElementById('extensionId'),
      extensionVersion: document.getElementById('extensionVersion'),
      manifestVersion: document.getElementById('manifestVersion'),
      enableVerboseLogging: document.getElementById('enableVerboseLogging'),
      enablePerformanceMonitoring: document.getElementById('enablePerformanceMonitoring'),
      enableConflictDetection: document.getElementById('enableConflictDetection'),
      logLevel: document.getElementById('logLevel'),
      statusMessage: document.getElementById('statusMessage'),
      storageContent: document.getElementById('storageContent'),
      realTimeInfo: document.getElementById('realTimeInfo')
    };
    
    // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
    function showStatus(message, type = 'success') {
      elements.statusMessage.textContent = message;
      elements.statusMessage.className = `status ${type}`;
      elements.statusMessage.style.display = 'block';
      
      setTimeout(() => {
        elements.statusMessage.style.display = 'none';
      }, 3000);
      
      console.log(`[Options] ${type.toUpperCase()}:`, message);
    }
    
    // å‘é€æ¶ˆæ¯åˆ°background
    function sendBackgroundMessage(type, data = {}) {
      return new Promise((resolve) => {
        chrome.runtime.sendMessage({ type, ...data }, (response) => {
          resolve(response);
        });
      });
    }
    
    // åˆå§‹åŒ–æ‰©å±•ä¿¡æ¯
    function initializeExtensionInfo() {
      const manifest = chrome.runtime.getManifest();
      elements.extensionId.value = chrome.runtime.id;
      elements.extensionVersion.value = manifest.version;
      elements.manifestVersion.value = manifest.manifest_version;
      
      console.log('[Options] ğŸ“‹ æ‰©å±•ä¿¡æ¯å·²åˆå§‹åŒ–');
    }
    
    // åŠ è½½è®¾ç½®
    async function loadSettings() {
      try {
        const settings = await chrome.storage.local.get([
          'enableVerboseLogging',
          'enablePerformanceMonitoring', 
          'enableConflictDetection',
          'logLevel'
        ]);
        
        elements.enableVerboseLogging.checked = settings.enableVerboseLogging || false;
        elements.enablePerformanceMonitoring.checked = settings.enablePerformanceMonitoring || true;
        elements.enableConflictDetection.checked = settings.enableConflictDetection || true;
        elements.logLevel.value = settings.logLevel || 'info';
        
        console.log('[Options] âš™ï¸ è®¾ç½®å·²åŠ è½½:', settings);
      } catch (error) {
        console.error('[Options] âŒ åŠ è½½è®¾ç½®å¤±è´¥:', error);
      }
    }
    
    // ä¿å­˜è®¾ç½®
    async function saveSettings() {
      try {
        const settings = {
          enableVerboseLogging: elements.enableVerboseLogging.checked,
          enablePerformanceMonitoring: elements.enablePerformanceMonitoring.checked,
          enableConflictDetection: elements.enableConflictDetection.checked,
          logLevel: elements.logLevel.value,
          lastModified: new Date().toISOString()
        };
        
        await chrome.storage.local.set(settings);
        showStatus('âœ… è®¾ç½®å·²ä¿å­˜');
        
        console.log('[Options] ğŸ’¾ è®¾ç½®å·²ä¿å­˜:', settings);
      } catch (error) {
        console.error('[Options] âŒ ä¿å­˜è®¾ç½®å¤±è´¥:', error);
        showStatus('âŒ ä¿å­˜è®¾ç½®å¤±è´¥', 'error');
      }
    }
    
    // æŸ¥çœ‹å­˜å‚¨å†…å®¹
    async function viewStorageContent() {
      try {
        const allData = await chrome.storage.local.get();
        elements.storageContent.textContent = JSON.stringify(allData, null, 2);
        elements.storageContent.style.display = 'block';
        
        console.log('[Options] ğŸ“‹ å­˜å‚¨å†…å®¹:', allData);
      } catch (error) {
        console.error('[Options] âŒ è·å–å­˜å‚¨å†…å®¹å¤±è´¥:', error);
      }
    }
    
    // æ›´æ–°å®æ—¶ä¿¡æ¯
    function updateRealTimeInfo() {
      const info = {
        timestamp: new Date().toISOString(),
        location: window.location.href,
        memory: performance.memory ? {
          used: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024) + 'MB',
          total: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024) + 'MB'
        } : 'N/A',
        chromeAPIAvailable: {
          storage: !!chrome.storage,
          runtime: !!chrome.runtime,
          tabs: !!chrome.tabs
        }
      };
      
      elements.realTimeInfo.textContent = JSON.stringify(info, null, 2);
    }
    
    // äº‹ä»¶ç›‘å¬å™¨
    document.getElementById('testAllFeatures').addEventListener('click', async () => {
      console.log('[Options] ğŸš€ å¼€å§‹å®Œæ•´åŠŸèƒ½æµ‹è¯•');
      showStatus('ğŸš€ å¼€å§‹å®Œæ•´åŠŸèƒ½æµ‹è¯•...');
      
      try {
        // æµ‹è¯•å­˜å‚¨
        await sendBackgroundMessage('test-storage');
        console.log('[Options] âœ… å­˜å‚¨æµ‹è¯•å®Œæˆ');
        
        // æµ‹è¯•æ€§èƒ½
        await sendBackgroundMessage('performance-test');
        console.log('[Options] âœ… æ€§èƒ½æµ‹è¯•å®Œæˆ');
        
        // ç”Ÿæˆæ—¥å¿—
        console.log('[Options] ğŸ“ æµ‹è¯•æ—¥å¿—');
        console.info('[Options] â„¹ï¸ ä¿¡æ¯æµ‹è¯•');
        console.warn('[Options] âš ï¸ è­¦å‘Šæµ‹è¯•');
        
        showStatus('âœ… å®Œæ•´åŠŸèƒ½æµ‹è¯•å®Œæˆ');
      } catch (error) {
        console.error('[Options] âŒ åŠŸèƒ½æµ‹è¯•å¤±è´¥:', error);
        showStatus('âŒ åŠŸèƒ½æµ‹è¯•å¤±è´¥', 'error');
      }
    });
    
    document.getElementById('generateLogs').addEventListener('click', () => {
      console.log('[Options] ğŸ“ ç”¨æˆ·è§¦å‘æ—¥å¿—ç”Ÿæˆ');
      console.info('[Options] â„¹ï¸ ä¿¡æ¯çº§åˆ«æ—¥å¿—æµ‹è¯•');
      console.warn('[Options] âš ï¸ è­¦å‘Šçº§åˆ«æ—¥å¿—æµ‹è¯•');
      console.error('[Options] âŒ é”™è¯¯çº§åˆ«æ—¥å¿—æµ‹è¯•');
      console.debug('[Options] ğŸ› è°ƒè¯•çº§åˆ«æ—¥å¿—æµ‹è¯•');
      
      showStatus('ğŸ“ æµ‹è¯•æ—¥å¿—å·²ç”Ÿæˆ');
    });
    
    document.getElementById('testStorage').addEventListener('click', async () => {
      await sendBackgroundMessage('test-storage');
      showStatus('ğŸ—„ï¸ å­˜å‚¨æµ‹è¯•å®Œæˆ');
    });
    
    document.getElementById('testConflicts').addEventListener('click', () => {
      // åˆ›å»ºä¸€äº›æ½œåœ¨å†²çªçš„æµ‹è¯•
      const testElement = document.createElement('div');
      testElement.id = 'content'; // å¯èƒ½ä¸é¡µé¢å†²çªçš„ID
      testElement.style.zIndex = '999999';
      document.body.appendChild(testElement);
      
      console.log('[Options] âš ï¸ å†²çªæµ‹è¯•å…ƒç´ å·²åˆ›å»º');
      showStatus('âš ï¸ å†²çªæµ‹è¯•å·²æ‰§è¡Œ');
    });
    
    document.getElementById('clearStorage').addEventListener('click', async () => {
      try {
        await chrome.storage.local.clear();
        showStatus('ğŸ§¹ å­˜å‚¨å·²æ¸…é™¤');
        console.log('[Options] ğŸ§¹ å­˜å‚¨å·²æ¸…é™¤');
      } catch (error) {
        console.error('[Options] âŒ æ¸…é™¤å­˜å‚¨å¤±è´¥:', error);
        showStatus('âŒ æ¸…é™¤å­˜å‚¨å¤±è´¥', 'error');
      }
    });
    
    document.getElementById('resetSettings').addEventListener('click', async () => {
      elements.enableVerboseLogging.checked = false;
      elements.enablePerformanceMonitoring.checked = true;
      elements.enableConflictDetection.checked = true;
      elements.logLevel.value = 'info';
      
      await saveSettings();
      showStatus('ğŸ”„ è®¾ç½®å·²é‡ç½®');
    });
    
    document.getElementById('viewStorage').addEventListener('click', viewStorageContent);
    
    // è®¾ç½®å˜æ›´æ—¶è‡ªåŠ¨ä¿å­˜
    ['enableVerboseLogging', 'enablePerformanceMonitoring', 'enableConflictDetection', 'logLevel'].forEach(id => {
      document.getElementById(id).addEventListener('change', saveSettings);
    });
    
    // åˆå§‹åŒ–
    initializeExtensionInfo();
    loadSettings();
    updateRealTimeInfo();
    
    // å®šæœŸæ›´æ–°å®æ—¶ä¿¡æ¯
    setInterval(updateRealTimeInfo, 3000);
    
    console.log('[Options] âœ¨ é€‰é¡¹é¡µé¢åˆå§‹åŒ–å®Œæˆ');
  </script>
</body>
</html>
